


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="soluble-mediatools ffmpeg wrapper documentation">
      
      
        <link rel="canonical" href="https://soluble-io.github.io/soluble-mediatools/video-conversion-service/">
      
      
        <meta name="author" content="Sébastien Vanvelthem">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.12">
    
    
      
        <title>✔ VideoConverter - Mediatools</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4dd2dd8d.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.6a5ad368.min.css">
      
      
        
        
        <meta name="theme-color" content="#ffffff">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700%7CSFMono-Regular,Consolas,Menlo,monospace&display=fallback">
        <style>body,input{font-family:"IBM Plex Sans",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"SFMono-Regular,Consolas,Menlo,monospace",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../_assets/css/mermaid.css">
    
      <link rel="stylesheet" href="../_assets/css/monokai.css">
    
      <link rel="stylesheet" href="../_assets/css/style.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#requirements" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://soluble-io.github.io/soluble-mediatools" title="Mediatools" class="md-header-nav__button md-logo" aria-label="Mediatools">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Mediatools
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              ✔ VideoConverter
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/soluble-io/soluble-mediatools/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    soluble-mediatools
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://soluble-io.github.io/soluble-mediatools" title="Mediatools" class="md-nav__button md-logo" aria-label="Mediatools">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Mediatools
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/soluble-io/soluble-mediatools/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    soluble-mediatools
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../video-info-service/" title="✔ VideoInfoReader" class="md-nav__link">
      ✔ VideoInfoReader
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        ✔ VideoConverter
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="✔ VideoConverter" class="md-nav__link md-nav__link--active">
      ✔ VideoConverter
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    Initialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conversion" class="md-nav__link">
    Conversion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filters" class="md-nav__link">
    Filters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exceptions" class="md-nav__link">
    Exceptions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    Notes
  </a>
  
    <nav class="md-nav" aria-label="Notes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compression" class="md-nav__link">
    Compression
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    Performance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recipes" class="md-nav__link">
    Recipes
  </a>
  
    <nav class="md-nav" aria-label="Recipes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transcode-to-mp4x264aac" class="md-nav__link">
    Transcode to mp4/x264/aac
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transcode-to-webmvp9opus" class="md-nav__link">
    Transcode to webm/vp9/opus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#video-scaling" class="md-nav__link">
    Video scaling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#video-clipping" class="md-nav__link">
    Video clipping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multipass-encoding" class="md-nav__link">
    Multipass encoding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../video-thumb-service/" title="✔ VideoThumbGenerator" class="md-nav__link">
      ✔ VideoThumbGenerator
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../video-detection-service/" title="✔ VideoAnalyzer" class="md-nav__link">
      ✔ VideoAnalyzer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../video-filters/" title="▧ Filters notes" class="md-nav__link">
      ▧ Filters notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../integration/" title="Integration" class="md-nav__link">
      Integration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    Initialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav" aria-label="Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conversion" class="md-nav__link">
    Conversion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filters" class="md-nav__link">
    Filters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exceptions" class="md-nav__link">
    Exceptions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    Notes
  </a>
  
    <nav class="md-nav" aria-label="Notes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compression" class="md-nav__link">
    Compression
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    Performance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recipes" class="md-nav__link">
    Recipes
  </a>
  
    <nav class="md-nav" aria-label="Recipes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transcode-to-mp4x264aac" class="md-nav__link">
    Transcode to mp4/x264/aac
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transcode-to-webmvp9opus" class="md-nav__link">
    Transcode to webm/vp9/opus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#video-scaling" class="md-nav__link">
    Video scaling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#video-clipping" class="md-nav__link">
    Video clipping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multipass-encoding" class="md-nav__link">
    Multipass encoding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/soluble-io/soluble-mediatools/edit/master/docs/video-conversion-service.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                    


  


<a href="https://github.com/soluble-io/soluble-mediatools/blob/master/src/Video/VideoConverter.php" title="Video/VideoConverter.php" class="md-content__button md-icon">
  Source
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
</a>
                  
                
                
                  <h1>✔ VideoConverter</h1>
                
                <p>The VideoConverter service acts as a wrapper over ffmpeg and
helps with video conversions, clipping, filters, scaling...</p>
<p>It exposes an immutable api for conversion parameters and attempt to make
debugging easier with clean exceptions. You can also inject any psr-3 compatible
logger if you don't want to log issues by yourself.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\Config\FFMpegConfig</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\Exception\ConverterExceptionInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\</span><span class="p">{</span><span class="nx">VideoConverter</span><span class="p">,</span> <span class="nx">VideoConvertParams</span><span class="p">};</span>

<span class="nv">$converter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VideoConverter</span><span class="p">(</span><span class="k">new</span> <span class="nx">FFMpegConfig</span><span class="p">(</span><span class="s1">&#39;/path/to/ffmpeg&#39;</span><span class="p">));</span>

<span class="hll"><span class="nv">$params</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">VideoConvertParams</span><span class="p">())</span>
</span><span class="hll">    <span class="o">-&gt;</span><span class="na">withVideoCodec</span><span class="p">(</span><span class="s1">&#39;libx264&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="o">-&gt;</span><span class="na">withStreamable</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
</span><span class="hll">    <span class="o">-&gt;</span><span class="na">withCrf</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>
</span>
<span class="k">try</span> <span class="p">{</span>
<span class="hll">    <span class="nv">$converter</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span>
</span><span class="hll">        <span class="s1">&#39;/path/inputFile.mov&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="s1">&#39;/path/outputFile.mp4&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="nv">$params</span>
</span><span class="hll">    <span class="p">);</span>
</span><span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">ConverterExceptionInterface</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// See chapter about exception !!!</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h3>
<p>You'll need to have ffmpeg <a href="../install-ffmpeg/">installed</a> on your system.</p>
<h3 id="initialization">Initialization<a class="headerlink" href="#initialization" title="Permanent link">&para;</a></h3>
<p>The <a href="https://github.com/soluble-io/soluble-mediatools/blob/master/src/Video/VideoConverter.php">VideoConverter</a>
requires an <a href="https://github.com/soluble-io/soluble-mediatools/blob/master/src/Video/Config/FFMpegConfig.php"><code>FFMpegConfig</code></a>
object as first parameter.
This is where you set the location of the ffmpeg binary, the number of threads you allow for conversions
and the various timeouts if needed. The second parameter can be used to inject any psr-3 compatible <mark>logger</mark>.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\Config\</span><span class="p">{</span><span class="nx">FFMpegConfig</span><span class="p">,</span> <span class="nx">FFMpegConfigInterface</span><span class="p">};</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\VideoConverter</span><span class="p">;</span>

<span class="nv">$converter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VideoConverter</span><span class="p">(</span>
    <span class="c1">// @param FFMpegConfigInterface</span>
    <span class="k">new</span> <span class="nx">FFMpegConfig</span><span class="p">(</span>
        <span class="c1">// (?string) - path to ffmpeg binary (default: ffmpeg/ffmpeg.exe)</span>
        <span class="nv">$binary</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="c1">// (?int)    - ffmpeg default threads (null: single-thread)</span>
        <span class="nv">$threads</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="c1">// (?float)  - max time in seconds for ffmpeg process (null: disable)</span>
        <span class="nv">$timeout</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="c1">// (?float)  - max idle time in seconds for ffmpeg process</span>
        <span class="nv">$idleTimeout</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="c1">// (array)   - additional environment variables</span>
        <span class="nv">$env</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">),</span>
    <span class="c1">// @param ?\Psr\Log\LoggerInterface - Default to `\Psr\Log\NullLogger`.</span>
    <span class="nv">$logger</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">);</span>
</code></pre></div>

<details class="tip"><summary>Tip: initialize in a container (psr-11)</summary><p>It's a good idea to register services in a container.
Depending on available framework integrations, you may have a look to the <a href="https://github.com/soluble-io/soluble-mediatools/blob/master/src/Video/VideoConverterFactory.php"><code>VideoConverterFactory</code></a>
and/or <a href="https://github.com/soluble-io/soluble-mediatools/blob/master/src/Video/Config/FFMpegConfigFactory.php"><code>FFMpegConfigFactory</code></a> to get an example based on a psr-11 compatible container.
See also the provided default <a href="https://github.com/soluble-io/soluble-mediatools/blob/master/config/soluble-mediatools.config.php">configuration</a> file.</p>
</details>
<h3 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h3>
<h4 id="conversion">Conversion<a class="headerlink" href="#conversion" title="Permanent link">&para;</a></h4>
<p>Typically you'll use the <code>VideoConverter::convert()</code> method in which you specify the input/output files
as well as the conversion params.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="nv">$conversionService</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span>
    <span class="s1">&#39;/path/inputFile.mov&#39;</span><span class="p">,</span>
     <span class="c1">// Output file will be automatically &#39;shell&#39; escaped,</span>
    <span class="s1">&#39;/path/outputFile.mp4&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="k">new</span> <span class="nx">VideoConvertParams</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">withVideoCodec</span><span class="p">(</span><span class="s1">&#39;libx264&#39;</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>

<p><em>The <code>convert()</code> method will automatically set the process timeouts, logger... as specified during
service initialization.</em></p>
<details class="question"><summary>What if I need more control over the process ? (advanced usage)</summary><p>You can use the <code>VideoConverter::getSymfonyProcess(string $inputFile, string $outputFile, VideoConvertParamsInterface $convertParams, ?ProcessParamsInterface $processParams = null): Process</code>
to get more control on the conversion process.
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="nv">$process</span> <span class="o">=</span> <span class="nv">$conversionService</span><span class="o">-&gt;</span><span class="na">getSymfonyProcess</span><span class="p">(</span>
    <span class="s1">&#39;/path/inputFile.mov&#39;</span><span class="p">,</span>
     <span class="s1">&#39;/path/outputFile.mp4&#39;</span><span class="p">,</span>
      <span class="p">(</span><span class="k">new</span> <span class="nx">VideoConvertParams</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">withVideoCodec</span><span class="p">(</span><span class="s1">&#39;libx264&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="nv">$process</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$process</span> <span class="k">as</span> <span class="nv">$type</span> <span class="o">=&gt;</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$process</span><span class="o">::</span><span class="na">OUT</span> <span class="o">===</span> <span class="nv">$type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Read from stdout: &quot;</span><span class="o">.</span><span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// $process::ERR === $type</span>
        <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Read from stderr: &quot;</span><span class="o">.</span><span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Have a look to the <a href="https://symfony.com/doc/current/components/process.html">symfony/process documentation</a> for more recipes.</p>
</details>
<h4 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h4>
<p>The <a href="https://github.com/soluble-io/soluble-mediatools/blob/master/src/Video/VideoConvertParams.php"><code>Video\VideoConvertParams</code></a>
exposes an immutable api that attempt to mimic ffmpeg params.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\VideoConvertParams</span><span class="p">;</span>

<span class="nv">$params</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">VideoConvertParams</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="na">withVideoCodec</span><span class="p">(</span><span class="s1">&#39;libx264&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withStreamable</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withCrf</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withPreset</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withAudioCodec</span><span class="p">(</span><span class="s1">&#39;aac&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withAudioBitrate</span><span class="p">(</span><span class="s1">&#39;128k&#39;</span><span class="p">);</span>
</code></pre></div>

<details class="question"><summary>Immutable api, what does it change for me ? (vs fluent)</summary><p>VideoConvertParams exposes an <mark>immutable</mark> style api <em>(<code>-&gt;withXXX()</code>, like PSR-7 for example)</em>.
It means that the original object is never touched, the <code>withXXX()</code> methods will return a newly
created object.</p>
<p>Please be aware of it especially if you're used to <sub><mark>fluent</mark></sub> interfaces as both expose
chainable methods... your primary reflexes might cause pain:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="nv">$params</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">VideoConvertParams</span><span class="p">());</span>

<span class="nv">$newParams</span> <span class="o">=</span> <span class="nv">$params</span><span class="o">-&gt;</span><span class="na">withVideoCodec</span><span class="p">(</span><span class="s1">&#39;libx264&#39;</span><span class="p">);</span>

<span class="hll"><span class="c1">// $params used here are empty (incorrect usage)</span>
</span><span class="nv">$converter</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;i.mov&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>

<span class="hll"><span class="c1">// $newParams have been initialized with video codec (correct)</span>
</span><span class="nv">$converter</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;i.mov&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="nv">$newParams</span><span class="p">);</span>
</code></pre></div>

</details>
<p>Here's a list of categorized built-in methods you can use. See the ffmpeg doc for more information.</p>
<ul>
<li>Video options:</li>
</ul>
<table>
<thead>
<tr>
<th>Method</th>
<th>FFmpeg arg(s)</th>
<th>Example(s)</th>
<th>Note(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>withVideoCodec(string)</code></td>
<td>-c:v ◌</td>
<td>libx264…</td>
<td>any supported ffmpeg codec</td>
</tr>
<tr>
<td><code>withVideoBitrate(string)</code></td>
<td>-b:v ◌</td>
<td>750k,2M…</td>
<td>constant bit rate</td>
</tr>
<tr>
<td><code>withVideoMinBitrate(string)</code></td>
<td>-minrate ◌</td>
<td>750k,2M…</td>
<td>min variable bitrate</td>
</tr>
<tr>
<td><code>withVideoMaxBitrate(string)</code></td>
<td>-maxrate ◌</td>
<td>750k,2M…</td>
<td>max variable bitrate</td>
</tr>
<tr>
<td><code>withCrf(int)</code></td>
<td>-crf ◌</td>
<td>32,…</td>
<td>constant rate factor</td>
</tr>
<tr>
<td><code>withStreamable()</code></td>
<td>-movflags +faststart</td>
<td></td>
<td><em>mp4 container only</em></td>
</tr>
<tr>
<td><code>withPixFmt(string)</code></td>
<td>-pix_fmt ◌</td>
<td>yuv420p</td>
<td>Default '<em>no change</em>'</td>
</tr>
<tr>
<td><code>withQuality(string)</code></td>
<td>-quality ◌</td>
<td>good,medium…</td>
<td></td>
</tr>
<tr>
<td><code>withPreset(string)</code></td>
<td>-preset ◌</td>
<td>fast…</td>
<td></td>
</tr>
<tr>
<td><code>withTune(string)</code></td>
<td>-tune ◌</td>
<td>film…</td>
<td></td>
</tr>
<tr>
<td><code>withVideoQualityScale(int)</code></td>
<td>-qscale:v ◌</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>withTileColumns(int)</code></td>
<td>-tile-columns ◌</td>
<td>10…</td>
<td><em>vp9 related</em></td>
</tr>
<tr>
<td><code>withKeyframeSpacing(int)</code></td>
<td>-g ◌</td>
<td>240…</td>
<td><em>vp9 related</em></td>
</tr>
<tr>
<td><code>withFrameParallel(int)</code></td>
<td>-frame-parallel ◌</td>
<td>2…</td>
<td><em>vp9 related</em></td>
</tr>
<tr>
<td><code>withLagInFrames(int)</code></td>
<td>-lag-in-frames ◌</td>
<td>25</td>
<td>vp9, use with <code>autoAltRef</code></td>
</tr>
<tr>
<td><code>withAutoAltRef(int)</code></td>
<td>-auto-alt-ref ◌</td>
<td>1</td>
<td>vp9, use with <code>lagInFrames</code></td>
</tr>
</tbody>
</table>
<ul>
<li>Audio options:</li>
</ul>
<table>
<thead>
<tr>
<th>Method</th>
<th>FFmpeg arg(s)</th>
<th>Example(s)</th>
<th>Note(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>withAudioCodec(string)</code></td>
<td>-c:a ◌</td>
<td>aac,mp3…</td>
<td><em>webm</em> requires vorbis/opus</td>
</tr>
<tr>
<td><code>withAudioBitrate(string)</code></td>
<td>-b:a ◌</td>
<td>128k…</td>
<td></td>
</tr>
<tr>
<td><code>withNoAudio()</code></td>
<td>-an</td>
<td></td>
<td>removes all audio tracks</td>
</tr>
</tbody>
</table>
<ul>
<li>Seeking/clipping options:</li>
</ul>
<table>
<thead>
<tr>
<th>Method</th>
<th>FFmpeg arg(s)</th>
<th>Example(s)</th>
<th>Note(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>withSeekStart(SeekTime)</code></td>
<td>-ss ◌</td>
<td><a href="https://github.com/soluble-io/soluble-mediatools/blob/master/src/Video/SeekTime.php"><code>SeekTime::createFromHms('0:00:01.9')</code></a></td>
<td></td>
</tr>
<tr>
<td><code>withSeekEnd(SeekTime)</code></td>
<td>-to ◌</td>
<td><code>new SeekTime(120.456)</code></td>
<td></td>
</tr>
<tr>
<td><code>withVideoFrames(int)</code></td>
<td>-frames:v ◌</td>
<td>1000…</td>
<td>Only ◌ frames</td>
</tr>
</tbody>
</table>
<ul>
<li>Filter related:</li>
</ul>
<table>
<thead>
<tr>
<th>Method</th>
<th>FFmpeg arg(s)</th>
<th>Example(s)</th>
<th>Note(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>withFilter(VideoFilterInterface)</code></td>
<td>-filter:v ◌</td>
<td></td>
<td>See doc section about filters</td>
</tr>
</tbody>
</table>
<ul>
<li>General process options:</li>
</ul>
<table>
<thead>
<tr>
<th>Method</th>
<th>FFmpeg arg(s)</th>
<th>Example(s)</th>
<th>Note(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>withSpeed(int)</code></td>
<td>-speed ◌</td>
<td>1,2,3…</td>
<td><em>for vp9 or multipass</em></td>
</tr>
<tr>
<td><code>withThreads(int)</code></td>
<td>-threads ◌</td>
<td>0,1,2…</td>
<td>by default uses FFMpegConfig</td>
</tr>
<tr>
<td><code>withOutputFormat(string)</code></td>
<td>-format ◌</td>
<td>mp4,webm…</td>
<td>file extension <em>(if not provided)</em></td>
</tr>
<tr>
<td><code>withOverwrite()</code></td>
<td>-y</td>
<td></td>
<td>by default. overwrite if file exists</td>
</tr>
<tr>
<td><code>withNoOverwrite()</code></td>
<td></td>
<td></td>
<td>throw exception if output exists</td>
</tr>
</tbody>
</table>
<ul>
<li>Multipass related</li>
</ul>
<table>
<thead>
<tr>
<th>Method</th>
<th>FFmpeg arg(s)</th>
<th>Example(s)</th>
<th>Note(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>withPassLogFile(string)</code></td>
<td>-passlogfile ◌</td>
<td></td>
<td>Ex: `tempnam(sys_get_temp_dir(), 'ffmpeg-log')</td>
</tr>
<tr>
<td><code>withPass(int)</code></td>
<td>-pass ◌</td>
<td>1 or 2</td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>Other methods:</li>
</ul>
<table>
<thead>
<tr>
<th>Method</th>
<th>Note(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>withConvertParam(VideoConvertParamInterface)</code></td>
<td>With extra <code>VideoConvertParams</code> (will be merged)</td>
</tr>
<tr>
<td><code>withBuiltInParam(string, mixed)</code></td>
<td>With any supported built-in param, see <a href="https://github.com/soluble-io/soluble-mediatools/blob/master/src/Video/VideoConvertParamsInterface.php">constants</a>.</td>
</tr>
<tr>
<td><code>withoutParam(string)</code></td>
<td>Without the specified parameter.</td>
</tr>
<tr>
<td><code>getParam(string $param): mixed</code></td>
<td>Return the param calue or throw UnsetParamExeption if not set.</td>
</tr>
<tr>
<td><code>hasParam(string $param): bool</code></td>
<td>Whether the param has been set.</td>
</tr>
<tr>
<td><code>toArray(): array</code></td>
<td>Return the object as array.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>To get the latest list of built-ins, see the
<a href="https://github.com/soluble-io/soluble-mediatools/blob/master/src/Video/VideoConvertParamsInterface.php">VideoConvertParamsInterface</a> and
<a href="https://github.com/soluble-io/soluble-mediatools/blob/master/src/Video/Adapter/FFMpegAdapter.php">FFMpegAdapter</a> sources.</p>
</blockquote>
<h4 id="filters">Filters<a class="headerlink" href="#filters" title="Permanent link">&para;</a></h4>
<p>Video filters can be set to the VideoConvertParams through the <code>-&gt;withVideoFilter(VideoFilterInterface $videoFilter)</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\Filter</span><span class="p">;</span>

<span class="nv">$params</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">VideoConvertParams</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="na">withVideoFilter</span><span class="p">(</span>
        <span class="k">new</span> <span class="nx">Filter\VideoFilterChain</span><span class="p">([</span>
            <span class="c1">// A scaling filter</span>
            <span class="k">new</span> <span class="nx">Filter\ScaleFilter</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span>
            <span class="c1">// A denoise filter</span>
            <span class="k">new</span> <span class="nx">Filter\Hqdn3DVideoFilter</span><span class="p">()</span>
        <span class="p">])</span>
    <span class="p">);</span>
</code></pre></div>

<p>See the <strong><a href="../video-filters/">complete video filters doc here</a></strong></p>
<h4 id="exceptions">Exceptions<a class="headerlink" href="#exceptions" title="Permanent link">&para;</a></h4>
<p>All conversion exceptions implements <code>Soluble\MediaTools\VideoException\ConverterExceptionInterface</code>,  interface.,
alternatively you can also :</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\</span><span class="p">{</span><span class="nx">VideoConverter</span><span class="p">,</span> <span class="nx">VideoConvertParams</span><span class="p">};</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\Exception</span> <span class="k">as</span> <span class="nx">VE</span><span class="p">;</span>

<span class="sd">/** @var VideoConverter $converter */</span>
<span class="nv">$params</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">VideoConvertParams</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">withVideoCodec</span><span class="p">(</span><span class="s1">&#39;xxx&#39;</span><span class="p">);</span>
<span class="k">try</span> <span class="p">{</span>

    <span class="nv">$converter</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span><span class="s1">&#39;i.mov&#39;</span><span class="p">,</span> <span class="s1">&#39;o.mp4&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>

<span class="c1">// All exception below implements VE\ConverterExceptionInterface</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">VE\MissingInputFileException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// &#39;i.mov does not exists</span>

    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span>

    <span class="c1">// The following 3 exceptions are linked to process</span>
    <span class="c1">// failure &#39;ffmpeg exit code != 0) and implements</span>
    <span class="c1">//</span>
    <span class="c1">// - `VE\ConversionProcessExceptionInterface`</span>
    <span class="c1">//        (* which extends Mediatools\Common\Exception\ProcessExceptionInterface)</span>
    <span class="c1">//</span>
    <span class="c1">// you can catch all them at once or separately:</span>

      <span class="nx">VE\ProcessFailedException</span>
    <span class="o">|</span> <span class="nx">VE\ProcessSignaledException</span>
    <span class="o">|</span> <span class="nx">VE\ProcessTimedOutException</span> <span class="nv">$e</span><span class="p">)</span>
<span class="p">{</span>

    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>

    <span class="c1">// Because they implement ProcessExceptionInterface</span>
    <span class="c1">// we can get a reference to the executed (symfony) process:</span>

    <span class="nv">$process</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getProcess</span><span class="p">();</span>
    <span class="k">echo</span> <span class="nv">$process</span><span class="o">-&gt;</span><span class="na">getExitCode</span><span class="p">();</span>
    <span class="k">echo</span> <span class="nv">$process</span><span class="o">-&gt;</span><span class="na">getErrorOutput</span><span class="p">();</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">VE\ConverterExceptionInterface</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Other exceptions can be</span>
    <span class="c1">//</span>
    <span class="c1">// - VE\RuntimeException</span>
    <span class="c1">// - VE\InvalidParamException (should not happen)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">&para;</a></h3>
<h4 id="compression">Compression<a class="headerlink" href="#compression" title="Permanent link">&para;</a></h4>
<p>Achieving a good level of compression while preserving quality is not that easy.</p>
<p>Compression techniques will depend on the codec (h264, av1, vp9), the purpose (archive, streaming, vod...)
and the size <em>(and fps)</em> of the original content. The mediatools <code>VideoConverter</code> is agnostic
and does not offer any help, you'll need to set up your own set of parameters.</p>
<p>There's a lot of ffmpeg recipes on internet that you can easily port, some interesting sources:</p>
<ul>
<li>FFMpeg <a href="https://trac.ffmpeg.org/wiki/Encode/VP9">VP9 encoding</a></li>
<li>FFMpeg <a href="https://trac.ffmpeg.org/wiki/Encode/H.264">H.264 encoding</a></li>
<li>Google <a href="https://developers.google.com/media/vp9/settings/vod/">VOD VP9 setting</a></li>
</ul>
<details class="tip" open="open"><summary>Variable or Constant Bitrate ?  Or both ?</summary><blockquote>
<p><em>tl;dr</em>: VBR and CBR can be set together to ensure max quality within a target bitrate (streamability++).</p>
</blockquote>
<p><strong>Variable Bitrate</strong></p>
<p>Variable bitrate (VBR) ensure that you’d achieve the lowest possible file size at the highest possible
quality under the given constraints.</p>
<p>Use the <code>VideoConvertParams::withBitrate()</code>, <code>withMaxBitrate()</code> and <code>withMinBitrate()</code> methods
to set what you want to achieve. But be warned bitrates must not be set blindly, to be effective
they must be choosen in respect to video dimensions and fps. See <a href="https://developers.google.com/media/vp9/settings/vod/">VOD VP9 setting</a>.</p>
<p><strong>Constant Bitrate</strong></p>
<p>The <code>VideoConvertParams::withCrf()</code> will set the Constant Rate Factor (CRF) setting
for the x264, x265 and vp9 encoders.</p>
<ul>
<li>
<p><strong>h26x:</strong> You can set the values between 0 and 51, where lower values would result in better quality,
        at the expense of higher file sizes. Higher values mean more compression,
        but at some point you will notice the quality degradation.
        For x264, sane values are between 18 and 28. The default is 23, so you can use this as a starting point.</p>
</li>
<li>
<p><strong>vpx:</strong>  The CRF value can be from 0–63. Lower values mean better quality. Recommended values range from 15–35,
        with 31 being recommended for 1080p HD video</p>
</li>
</ul>
<blockquote>
<p><em>Please also be sure to understand what rate control modes are
(you can see <a href="https://slhck.info/video/2017/03/01/rate-control.html">here</a>
and <a href="https://slhck.info/video/2017/02/24/crf-guide.html">here</a> and how to choose the one you need.</em></p>
</blockquote>
</details>
<h4 id="performance">Performance<a class="headerlink" href="#performance" title="Permanent link">&para;</a></h4>
<p>Conversions are heavy dudes, things that can help:</p>
<ul>
<li>Increasing the FfmpegConfig threads parameter can help for some tasks.</li>
<li>Order of parameters can help. i.e: if you need to clip, makes it before applying filters.</li>
</ul>
<h3 id="recipes">Recipes<a class="headerlink" href="#recipes" title="Permanent link">&para;</a></h3>
<h4 id="transcode-to-mp4x264aac">Transcode to <code>mp4/x264/aac</code><a class="headerlink" href="#transcode-to-mp4x264aac" title="Permanent link">&para;</a></h4>
<blockquote>
<p>See the <a href="https://trac.ffmpeg.org/wiki/Encode/H.264">official H264</a> doc.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\</span><span class="p">{</span><span class="nx">Exception</span><span class="p">,</span> <span class="nx">VideoConvertParams</span><span class="p">};</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\VideoConverterInterface</span><span class="p">;</span>

<span class="nv">$params</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">VideoConvertParams</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="na">withVideoCodec</span><span class="p">(</span><span class="s1">&#39;libx264&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withAudioCodec</span><span class="p">(</span><span class="s1">&#39;aac&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withAudioBitrate</span><span class="p">(</span><span class="s1">&#39;128k&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withStreamable</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>      <span class="c1">// Add streamable options (movflags &amp; faststart)</span>
    <span class="o">-&gt;</span><span class="na">withCrf</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>               <span class="c1">// Level of compression: better size / less visual quality</span>
    <span class="o">-&gt;</span><span class="na">withPreset</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">);</span>       <span class="c1">// Optional: see presets</span>

<span class="k">try</span> <span class="p">{</span>

    <span class="sd">/** @var VideoConverterInterface $converter */</span>

    <span class="nv">$converter</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span>
        <span class="s1">&#39;/path/inputFile.mov&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/path/outputFile.mp4&#39;</span><span class="p">,</span>
        <span class="nv">$params</span>
    <span class="p">);</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Exception\ConverterExceptionInterface</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// See chapters about exception !!!</span>

<span class="p">}</span>
</code></pre></div>

<h4 id="transcode-to-webmvp9opus">Transcode to <code>webm/vp9/opus</code><a class="headerlink" href="#transcode-to-webmvp9opus" title="Permanent link">&para;</a></h4>
<blockquote>
<p>See the official <a href="https://trac.ffmpeg.org/wiki/Encode/VP9">ffmpeg VP9 docs</a>
and have a look at the <a href="https://developers.google.com/media/vp9/settings/vod/#ffmpeg_command_lines">google vp9 VOD</a> guidelines</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\</span><span class="p">{</span><span class="nx">Exception</span><span class="p">,</span> <span class="nx">VideoConvertParams</span><span class="p">};</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\VideoConverterInterface</span><span class="p">;</span>

<span class="nv">$params</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">VideoConvertParams</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="na">withVideoCodec</span><span class="p">(</span><span class="s1">&#39;libvpx-vp9&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withVideoBitrate</span><span class="p">(</span><span class="s1">&#39;750k&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withQuality</span><span class="p">(</span><span class="s1">&#39;good&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withCrf</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withAudioCodec</span><span class="p">(</span><span class="s1">&#39;libopus&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withAudioBitrate</span><span class="p">(</span><span class="s1">&#39;128k&#39;</span><span class="p">)</span>
    <span class="sd">/**</span>
<span class="sd">     * It is recommended to allow up to 240 frames of video between keyframes (8 seconds for 30fps content).</span>
<span class="sd">     * Keyframes are video frames which are self-sufficient; they don&#39;t rely upon any other frames to render</span>
<span class="sd">     * but they tend to be larger than other frame types.</span>
<span class="sd">     * For web and mobile playback, generous spacing between keyframes allows the encoder to choose the best</span>
<span class="sd">     * placement of keyframes to maximize quality.</span>
<span class="sd">     */</span>
    <span class="o">-&gt;</span><span class="na">withKeyframeSpacing</span><span class="p">(</span><span class="mi">240</span><span class="p">)</span>
    <span class="c1">// Most of the current VP9 decoders use tile-based, multi-threaded decoding.</span>
    <span class="c1">// In order for the decoders to take advantage of multiple cores,</span>
    <span class="c1">// the encoder must set tile-columns and frame-parallel.</span>
    <span class="o">-&gt;</span><span class="na">withTileColumns</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withFrameParallel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withSpeed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">// Optional: Use videoprobe to be sure of color conversions if any needed</span>
    <span class="c1">// -&gt;withPixFmt(&#39;yuv420p&#39;)</span>
    <span class="o">-&gt;</span><span class="na">withOutputFormat</span><span class="p">(</span><span class="s1">&#39;webm&#39;</span><span class="p">);</span>


<span class="k">try</span> <span class="p">{</span>

    <span class="sd">/** @var VideoConverterInterface $converter */</span>

    <span class="nv">$converter</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span>
        <span class="s1">&#39;/path/inputFile.mov&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/path/outputFile.webm&#39;</span><span class="p">,</span>
        <span class="nv">$params</span>
    <span class="p">);</span>

<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Exception\ConverterExceptionInterface</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// see chapter about exceptions</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="video-scaling">Video scaling<a class="headerlink" href="#video-scaling" title="Permanent link">&para;</a></h4>
<blockquote>
<p>See also <a href="https://trac.ffmpeg.org/wiki/Scaling">ffmpeg doc</a></p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\</span><span class="p">{</span><span class="nx">Exception</span><span class="p">,</span> <span class="nx">VideoConvertParams</span><span class="p">,</span> <span class="nx">SeekTime</span><span class="p">};</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\Filter\ScaleFilter</span><span class="p">;</span>

<span class="nv">$params</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">VideoConvertParams</span><span class="p">())</span>
          <span class="o">-&gt;</span><span class="na">withVideoFilter</span><span class="p">(</span>
                <span class="k">new</span> <span class="nx">ScaleFilter</span><span class="p">(</span>
                    <span class="c1">// $width:  as an int or any ffmpeg supported placeholder: iw*0.5, ...</span>
                    <span class="mi">800</span><span class="p">,</span>
                    <span class="c1">// $height:  as an int or any ffmpeg supported placeholder: ih*0.5, ...</span>
                    <span class="s1">&#39;ih*0.5&#39;</span><span class="p">,</span>
                    <span class="c1">// $aspect_ratio_mode (increase or decrease)</span>
                    <span class="nx">ScaleFilter</span><span class="o">::</span><span class="na">OPTION_ASPECT_RATIO_INCREASE</span>
                <span class="p">)</span>
          <span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="sd">/** @var \Soluble\MediaTools\Video\VideoConverterInterface $videoConverter */</span>
    <span class="nv">$videoConverter</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span>
        <span class="s1">&#39;/path/inputFile.mp4&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/path/outputFile.mp4&#39;</span><span class="p">,</span>
        <span class="nv">$params</span>
    <span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Exception\ConverterExceptionInterface</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// see chapter about exceptions</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="video-clipping">Video clipping<a class="headerlink" href="#video-clipping" title="Permanent link">&para;</a></h4>
<blockquote>
<p>See the official <a href="https://trac.ffmpeg.org/wiki/Seeking">ffmpeg docs</a></p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\</span><span class="p">{</span><span class="nx">Exception</span><span class="p">,</span> <span class="nx">VideoConvertParams</span><span class="p">,</span> <span class="nx">SeekTime</span><span class="p">};</span>

<span class="nv">$params</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">VideoConvertParams</span><span class="p">())</span>
          <span class="o">-&gt;</span><span class="na">withSeekStart</span><span class="p">(</span><span class="k">new</span> <span class="nx">SeekTime</span><span class="p">(</span><span class="mf">10.242</span><span class="p">))</span> <span class="c1">// 10 sec, 242 milli</span>
          <span class="o">-&gt;</span><span class="na">withSeekEnd</span><span class="p">(</span><span class="nx">SeekTime</span><span class="o">::</span><span class="na">createFromHMS</span><span class="p">(</span><span class="s1">&#39;12:52.015&#39;</span><span class="p">));</span> <span class="c1">// 12 mins, 52 secs...</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="sd">/** @var \Soluble\MediaTools\Video\VideoConverterInterface $videoConverter */</span>
    <span class="nv">$videoConverter</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span>
        <span class="s1">&#39;/path/inputFile.mp4&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/path/outputFile.mp4&#39;</span><span class="p">,</span>
        <span class="nv">$params</span>
    <span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Exception\ConverterExceptionInterface</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// see chapter about exceptions</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="multipass-encoding">Multipass encoding<a class="headerlink" href="#multipass-encoding" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Video\</span><span class="p">{</span><span class="nx">VideoConvertParams</span><span class="p">,</span> <span class="nx">VideoConvertParamsInterface</span><span class="p">};</span>
<span class="k">use</span> <span class="nx">Soluble\MediaTools\Common\IO\PlatformNullFile</span><span class="p">;</span>

<span class="c1">// Where to store the result of first pass analysis</span>

<span class="nv">$logFile</span> <span class="o">=</span> <span class="nb">tempnam</span><span class="p">(</span><span class="nb">sys_get_temp_dir</span><span class="p">(),</span> <span class="s1">&#39;ffmpeg-passlog&#39;</span><span class="p">);</span>

<span class="nv">$pass1Params</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">VideoConvertParams</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="na">withVideoCodec</span><span class="p">(</span><span class="s1">&#39;libvpx-vp9&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withVideoBitrate</span><span class="p">(</span><span class="s1">&#39;1M&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withVideoMaxBitrate</span><span class="p">(</span><span class="s1">&#39;1500k&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withVideoMinBitrate</span><span class="p">(</span><span class="s1">&#39;750k&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withKeyframeSpacing</span><span class="p">(</span><span class="mi">240</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withTileColumns</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withFrameParallel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">// Set the pass number</span>
    <span class="o">-&gt;</span><span class="na">withPass</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">// Set the ffmpeg logfile</span>
    <span class="o">-&gt;</span><span class="na">withPassLogFile</span><span class="p">(</span><span class="nv">$logFile</span><span class="p">)</span>
    <span class="c1">// Speed in first pass can be faster</span>
    <span class="o">-&gt;</span><span class="na">withSpeed</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="c1">// Audio does not need to be analyzed</span>
    <span class="o">-&gt;</span><span class="na">withNoAudio</span><span class="p">()</span>
    <span class="c1">// Because we will pipe it to /dev/null</span>
    <span class="c1">// we need to specify container</span>
    <span class="o">-&gt;</span><span class="na">withOutputFormat</span><span class="p">(</span><span class="s1">&#39;webm&#39;</span><span class="p">);</span>


<span class="c1">// PASS 1 Conversion</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">videoConvert</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span>
        <span class="s1">&#39;/tmp/input.mov&#39;</span><span class="p">,</span>
        <span class="c1">// In first pass we don&#39;t need to output the conversion result</span>
        <span class="c1">// let&#39;s put in /dev/null.</span>
        <span class="k">new</span> <span class="nx">PlatformNullFile</span><span class="p">(),</span>
        <span class="nv">$pass1Params</span>
<span class="p">);</span>

<span class="c1">// Let&#39;s init pass 2 params from pass 1</span>
<span class="nv">$pass2Params</span> <span class="o">=</span> <span class="nv">$pass1Params</span>
    <span class="c1">// reinit audio</span>
    <span class="o">-&gt;</span><span class="na">withoutParam</span><span class="p">(</span><span class="nx">VideoConvertParamsInterface</span><span class="o">::</span><span class="na">PARAM_NOAUDIO</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withAudioCodec</span><span class="p">(</span><span class="s1">&#39;libopus&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">withAudioBitrate</span><span class="p">(</span><span class="s1">&#39;256k&#39;</span><span class="p">)</span>
    <span class="c1">// Reset the pass number</span>
    <span class="o">-&gt;</span><span class="na">withPass</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1">// Speed in second pass must be slower</span>
    <span class="o">-&gt;</span><span class="na">withSpeed</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>


<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">videoConvert</span><span class="o">-&gt;</span><span class="na">convert</span><span class="p">(</span>
    <span class="s1">&#39;/tmp/input.mov&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/tmp/output.webm&#39;</span><span class="p">,</span>
    <span class="nv">$pass2Params</span>
<span class="p">);</span>
</code></pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../video-info-service/" title="✔ VideoInfoReader" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                ✔ VideoInfoReader
              </div>
            </div>
          </a>
        
        
          <a href="../video-thumb-service/" title="✔ VideoThumbGenerator" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                ✔ VideoThumbGenerator
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018-2020 Sébastien Vanvelthem
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/soluble-io/soluble-mediatools" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.3636a4ec.min.js"></script>
      <script src="../assets/javascripts/bundle.e9fe3281.min.js"></script><script id="__lang" type="application/json">{"search.config.lang": "en", "search.result.placeholder": "Type to start searching", "search.result.other": "# matching documents", "search.config.pipeline": "trimmer, stopWordFilter", "clipboard.copy": "Copy to clipboard", "search.result.none": "No matching documents", "search.config.separator": "[\\s\\-]+", "search.result.one": "1 matching document", "clipboard.copied": "Copied to clipboard"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ["instant"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../_assets/js/mermaid-8.5.0.min.js"></script>
      
    
  </body>
</html>